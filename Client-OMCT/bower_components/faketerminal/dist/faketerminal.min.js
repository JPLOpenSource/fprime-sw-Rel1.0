window.FakeTerminal||(window.FakeTerminal={}),window.FakeTerminal.command||(window.FakeTerminal.command={}),window.FakeTerminal.defaultOptions={username:"root",hostname:window.location.host,history:1e3,prompt:"[%username%@%hostname%: %cwd%] ",login:null,cwd:"~"},window.FakeTerminal.main=function(a,b){var c=this;if(!jQuery)throw"FakeTerminal: jQuery required";var d=jQuery;c.$el=d(a),c.originalHtml="",c.existingText=[],c.executingCommand={instance:null,deferred:null},c.keymap={ENTER:13,UP:38,DOWN:40,C:67,D:68,U:85},c.output=null,c.input=null,c.filesystem=null,c.history=null,c.__construct=function(){c.$el.trigger("ft:init",[c]),c.options=d.extend({},window.FakeTerminal.defaultOptions,b),c.originalHtml=c.$el.get(0).outerHTML,c.existingText=c.$el.get(0).innerHTML?c.$el.get(0).innerHTML.split("\n"):[],c.$el.addClass("faketerminal").empty(),c.bindListeners(),c.output=new window.FakeTerminal.output(c),c.input=new window.FakeTerminal.input(c),c.filesystem=new window.FakeTerminal.filesystem(c),c.history=new window.FakeTerminal.history(c);for(var a=0,e=c.existingText.length;a<e;a++)c.existingText.length>1&&0===a||c.existingText.length>1&&a===c.existingText.length-1||c.output.write(d.trim(c.existingText[a]));c.input.focus(),c.$el.trigger("ft:ready",[c]),c.options.login&&c.exec(c.options.login)},c.bindListeners=function(){c.$el.on("click",function(){c.input.focus()}).on("keyup",function(a){a.ctrlKey&&a.which===c.keymap.C?c.input.ctrlC():a.ctrlKey&&a.which===c.keymap.U&&c.input.ctrlU()})},c.findCommand=function(a){var b;return"function"==typeof window.FakeTerminal.command[a]&&(b=new window.FakeTerminal.command[a](c)),b},c.getPrompt=function(){var a,b,d,e;return a="function"==typeof c.options.hostname?c.options.hostname.call():c.options.hostname,b="function"==typeof c.options.username?c.options.username.call():c.options.username,d="function"==typeof c.options.cwd?c.options.cwd.call():c.options.cwd,b=b.toLowerCase().replace(/[^a-z0-9]/g,""),e=c.options.prompt,e=e.replace(/%hostname%/g,a),e=e.replace(/%username%/g,b),e=e.replace(/%cwd%/g,d),c.colorize(e)},c.colorize=function(a){return a=a.replace(/<([a-zA-Z].+?)>/g,'<span class="color--$1">',a),a=a.replace(/<\/([a-zA-Z].+)>/g,"</span>",a)},c.scrollToBottom=function(){return c.$el.scrollTop(c.$el.get(0).scrollHeight),c},c.destroy=function(){return c.$el.replaceWith(d(c.originalHtml)),c.$el.trigger("ft:destroy",[c]),c},c.exec=function(a,b){var e,f,g,h;return e=new d.Deferred,a=d.trim(a),b||c.output.write(a,!0),0===a.length?(e.reject(),e.promise()):(f=d.trim(a.split(" ").slice(0,1)),g=a.split(" ").slice(1),h=c.findCommand(f),h?(c.executingCommand.instance&&(c.executingCommand.instance.terminate(),c.executingCommand.instance=null,c.executingCommand.deferred=null),c.input.disable(),c.executingCommand.instance=h,c.executingCommand.deferred=h.execute.apply(h,g).done(function(){e.resolve(arguments)}).fail(function(){e.reject(arguments)}).always(function(){c.input.enable().focus()})):f.length>0?(b||c.output.write('command not found: "'+f+'"'),e.reject()):e.reject(),b||c.history.push(f),c.$el.trigger("ft:command",[c,f]),e.promise())},c.__construct()},window.FakeTerminal.output=function(a){var b=this;return b.$screen=null,b.__construct=function(){return b.$screen=$("<div>").addClass("faketerminal__screen"),a.$el.append(b.$screen),b},b.write=function(c,d){var e=$("<div>").addClass("faketerminal__screen__line");return d&&e.append($("<div>").addClass("faketerminal__prompt").html(a.getPrompt())),c=a.colorize(c),c=c.replace(/ /g,"&nbsp;",c),c=c.replace(/<span&nbsp;class="/g,'<span class="',c),c=c.replace(/<div&nbsp;class="/g,'<div class="',c),e.append(c),b.$screen.append(e),a.scrollToBottom(),b},b.clear=function(){return b.$screen.empty(),b},b.__construct()},window.FakeTerminal.input=function(a){var b=this;return b.$input=null,b.$request=null,b.$commandLine=null,b.$inputRequest=null,b.__construct=function(){return b.$prompt=$("<div>").addClass("faketerminal__prompt").attr("autocorrect","off").attr("autocapitalize","none").html(a.getPrompt()),b.$input=$("<input>").on("keyup",function(c){switch(c.which){case a.keymap.ENTER:a.exec(b.read()).done(function(){b.$prompt.html(a.getPrompt())});break;case a.keymap.UP:case a.keymap.DOWN:b.set(a.history.browse(c.which))}}),b.$commandLine=$("<div>").addClass("faketerminal__commandline"),b.$request=$("<input>"),b.$inputRequest=$("<div>").addClass("faketerminal__commandline faketerminal__commandline--request"),a.$el.append(b.$commandLine.append(b.$prompt).append(b.$input)).append(b.$inputRequest.append(b.$request)),b.enable(),b.disableRequest(),b},b.read=function(){var a=b.$input.val();return b.$input.val(""),a},b.request=function(a){switch(a=a||"TEXT",a=a.toUpperCase()){case"TEXT":return b.requestText();case"BOOL":case"BOOLEAN":return b.requestBool();case"PASSWORD":return b.requestPassword();default:throw"Invalid request type"}},b.requestText=function(c){var d=new $.Deferred;return b.enableRequest(),b.$request.on("keyup",function(e){if(e.which===a.keymap.ENTER){var f=$.trim(b.$request.val());c||a.output.write(f),d.resolve(f),a.$el.trigger("ft:command",[a,f])}}),d.always(function(){b.disableRequest(),b.$request.off("keyup")}),d.promise()},b.requestBool=function(){var a=new $.Deferred;return b.requestText().done(function(b){b=$.trim(String(b).toLowerCase()),-1!==["1","true","yes","y","ok"].indexOf(b)?a.resolve():a.reject()}),a.promise()},b.requestPassword=function(){var c=new $.Deferred;return b.$request.addClass("is-password"),a.output.write("Password:"),b.requestText(!0).done(function(a){b.$request.removeClass("is-password"),c.resolve(a)}),c.promise()},b.set=function(a){b.$input.val(a)},b.focus=function(){return b.$input.is(":visible")?b.$input.focus():b.$request.is(":visible")&&b.$request.focus(),b},b.enable=function(){return b.$commandLine.show(),b.focus(),b},b.disable=function(){return b.$commandLine.hide(),b.$input.val(""),b},b.enableRequest=function(){return b.$inputRequest.show(),b.focus(),b},b.disableRequest=function(){return b.$inputRequest.hide(),b.$request.val(""),b},b.ctrlC=function(){if(a.executingCommand.instance)a.executingCommand.instance.terminate(),a.executingCommand.instance=null,a.executingCommand.deferred=null,a.output.write("^C",!0);else{var c=b.read();c.length&&(a.output.write(c,!0),a.output.write("^C",!0)),a.output.write("",!0)}return b.disableRequest(),b.focus(),b},b.ctrlU=function(){return b.$input.val(""),b},b.__construct()},window.FakeTerminal.filesystem=function(a){var b=this;return b.__construct=function(){return b},b.__construct()},window.FakeTerminal.history=function(a){var b=this;return b.counter=0,b.items=[],b.browseIndex=null,b.__construct=function(){return b},b.push=function(c){b.counter++,b.items.push({counter:b.counter,command:c}),b.items.length>a.options.history&&(b.items=b.items.slice(b.items.length-a.options.history))},b.browse=function(c){return c===a.keymap.UP?(null===b.browseIndex&&(b.browseIndex=b.items.length),--b.browseIndex<0&&(b.browseIndex=0)):c===a.keymap.DOWN&&(null===b.browseIndex&&(b.browseIndex=0),++b.browseIndex>=b.items.length&&(b.browseIndex=b.items.length)),b.items[b.browseIndex]?b.items[b.browseIndex].command:null},b.__construct()},window.FakeTerminal.command=function(a){var b=this;b.deferred=new $.Deferred,b.info=function(){return{private:!0}},b.execute=function(){return b.deferred.resolve(),b.deferred.promise()},b.terminate=function(){b.deferred.reject()}},window.FakeTerminal.command.clear=function(a){window.FakeTerminal.command.apply(this,arguments);var b=this;return b.info=function(){return{description:"Clears the screen"}},b.execute=function(){return a.output.clear(),b.deferred.resolve(),b.deferred.promise()},b},window.FakeTerminal.command.echo=function(a){window.FakeTerminal.command.apply(this,arguments);var b=this;return b.info=function(){return{description:"Writes an argument to the standard output"}},b.execute=function(){var c,d=$.makeArray(arguments);return c=d.join(" "),c=$.trim(c),c=c.replace(/["']/g,""),c=c.replace(/["']/g,""),0===c.length&&(c=" "),a.output.write(c),b.deferred.resolve(),b.deferred.promise()},b},window.FakeTerminal.command.help=function(a){window.FakeTerminal.command.apply(this,arguments);var b=this;return b.info=function(){return{description:"Displays information about the available commands"}},b.execute=function(){var c=[],d={};if(0===arguments.length){c.push("The following commands are available, run <info>help [command]</info> to find out more."),c.push(" ");var e="";$.each(window.FakeTerminal.command,function(b){var c=a.findCommand(b);c&&("function"==typeof c.info&&(d=c.info(),"boolean"==typeof d.private&&!0===d.private)||(e+=b+"    "))}),c.push(e),c.push(" ")}else{var f=a.findCommand(arguments[0]);f?("function"==typeof f.info&&(d=f.info(),"string"==typeof d.description?c=[" ",arguments[0]+" -- <comment>"+d.description+"</comment>"," "]:"object"==typeof d.description&&(c=d.description)),0===c.length&&(c=[" ",'No description for "'+f+'"'," "])):c=[" ",'"'+f+'" is not a valid command'," "]}for(var g=0;g<c.length;g++)a.output.write(c[g]);return b.deferred.resolve(),b.deferred.promise()},b},window.FakeTerminal.command.man=function(){return window.FakeTerminal.command.help.apply(this,arguments),this},window.FakeTerminal.command.history=function(a){window.FakeTerminal.command.apply(this,arguments);var b=this;return b.info=function(){return{description:"Displays the command history, up to "+a.options.historyLength+" items"}},b.execute=function(){a.output.write("  ");for(var c=0;c<a.history.items.length;c++)a.output.write(a.history.items[c].counter+"  "+a.history.items[c].command);return a.output.write("  "),b.deferred.resolve(),b.deferred.promise()},b},window.FakeTerminal.command.sleep=function(a){window.FakeTerminal.command.apply(this,arguments);var b=this;return b.timeout=null,b.info=function(){return{description:"Does nothing for a short while"}},b.execute=function(){var c=0;return arguments.length&&(c=parseInt(arguments[0])),a.output.write("Sleeping for "+c+" seconds..."),b.timeout=setTimeout(function(){a.output.write("awake!"),b.deferred.resolve()},1e3*c),b.deferred.promise()},b.terminate=function(){clearTimeout(b.timeout),b.deferred.reject()},b},window.FakeTerminal.command.test=function(a){window.FakeTerminal.command.apply(this,arguments);var b=this;return b.info=function(){return{description:"Clears the screen"}},b.execute=function(){return a.output.write("What is your name?"),a.input.request().done(function(c){a.output.write("Hi "+c+"!"),a.output.write("Want to tell me a secret?"),a.input.request("bool").done(function(){a.output.write("Nice one, go ahead, what is it?"),a.input.request("password").done(function(c){a.output.write("Wow, juicy! I promise not to tell anyone about it"),b.deferred.resolve()})}).fail(function(){a.output.write("OK, nevermind, many next time"),b.deferred.resolve()})}),b.deferred.promise()},b},window.FakeTerminal.command.whoami=function(a){window.FakeTerminal.command.apply(this,arguments);var b=this;return b.info=function(){return{description:"Prints the user's username to standard output"}},b.execute=function(){return a.output.write(a.options.username),b.deferred.resolve(),b.deferred.promise()},b},function(a){a.fn.faketerminal=function(b){return this.each(function(){a(this).data("instance",new window.FakeTerminal.main(this,b))})}}(jQuery);
//# sourceMappingURL=faketerminal.min.js.map